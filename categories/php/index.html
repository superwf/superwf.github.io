<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>php | 老王的日志</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.68.3" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.1cb140d8ba31d5b2f1114537dd04802a.css" rel="stylesheet">
    

    

    
      
    

    
    
      <link href="/categories/php/index.xml" rel="alternate" type="application/rss+xml" title="老王的日志" />
      <link href="/categories/php/index.xml" rel="feed" type="application/rss+xml" title="老王的日志" />
      
    
    
    <meta property="og:title" content="php" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="http://superwf.github.io/categories/php/" />
<meta property="og:updated_time" content="2014-07-30T08:35:58+00:00" />
<meta itemprop="name" content="php">
<meta itemprop="description" content=""><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="php"/>
<meta name="twitter:description" content=""/>

  </head>

  <body class="ma0 avenir bg-near-white">

    

  <header>
    <div class="pb3-m pb6-l bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="http://superwf.github.io/" class="f3 fw2 hover-white no-underline white-90 dib">
      老王的日志
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/migrate2020/" title="migrate2020 page">
              migrate2020
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/coder-life/" title="coder-life page">
              coder-life
            </a>
          </li>
          
        </ul>
      
      














    </div>
  </div>
</nav>

      <div class="tc-l pv3 ph3 ph4-ns">
        <h1 class="f2 f-subheadline-l fw2 light-silver mb0 lh-title">
          php
        </h1>
        
      </div>
    </div>
  </header>


    <main class="pb7" role="main">
      
  <article class="cf pa3 pa4-m pa4-l">
    <div class="measure-wide-l center f4 lh-copy nested-copy-line-height nested-links nested-img mid-gray">
      <p>Below you will find pages that utilize the taxonomy term “php”</p>
    </div>
  </article>
  <div class="mw8 center">    
    <section class="flex-ns flex-wrap justify-around mt5">
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="http://superwf.github.io/p906/" class="link black dim">
        最近又看了看php,做了几个ab的测试
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      最近折腾服务器部署，感觉rails占内存多有时候需要重启服务才能缓解一下卡的情况。
考虑之后的程序用什么来做，于是又搜了一下php，发现几年真是大发展php的明明空间大量应用，匿名函数和闭包竟然都支持了，laravel的几个命令行工具，简明语义的语法写法，composer这个类似bundle的好东西，使php本身的混乱程度大幅减少。
命名空间之前还听说的时候没见哪实际用过，现在看看一些新库的代码都已经用在生产上了，php还是很有搞头。
发现了phalcom这个php框架，竟然是用c写的来大幅提升系统性能，实在是令人意外。
于是用phalcom网站的测试方法测试了一下各个框架
ab和程序都是运行在同一主机，6g内存apu4核
测试了一下各个框架的ab -n 2000 -c 10 http://xxxx
rails用的是rails4.1，新建的一个临时程序，nginx + unicorn，就简单的能跑出hello world，在production模式下
Concurrency Level: 10
Time taken for tests: 1.461 seconds
Complete requests: 2000
Failed requests: 0
Total transferred: 888000 bytes
HTML transferred: 22000 bytes
Requests per second: 1369.20 [#/sec] (mean)
Time per request: 7.304 [ms] (mean)
Time per request: 0.730 [ms] (mean, across all concurrent requests)
Transfer rate: 593.68 [Kbytes/sec] received
beego的helloworld
Concurrency Level: 10
    </div>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="http://superwf.github.io/p654/" class="link black dim">
        php included from debug_backtrace
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      今天改个php的模板，不知道文件是从哪里调用的。找到了这么个函数，把所有includer以数组的形式显示出来，递归查看调用信息。
很方便
http://stackoverflow.com/questions/5204830/can-an-included-php-file-know-where-it-was-included-from
  
    </div>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="http://superwf.github.io/p496/" class="link black dim">
        php email
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      有个用php发送邮件的玩意出了问题。
看了一下，原来的东西用的是phpmailer，用的一个163的邮箱做smtp验证发送。
出问题是因为当天发送太多了，我进了一下这个163邮箱发现直接用网页发送提示数量超额，只能第二天接着发。
于是打算把这个服务改到自己的邮件服务器上。
不过phpmailer这玩意实在不好用，无论如何不能通过验证…
于是看了一下roundcube里，用的是pear的net_smpt
于是也就跟着用了。
改了之后测试了一下，用户名密码肯定都没问题的情况下出错
relay access denied
出错几次之后还被自己的防火墙给封了….
幸亏邮件服务器也是自己的，改了一下postfix的main.cf
在 mynetworks 里把自己服务器的ip也加了进去，凑合能发了。
但是 gmail的邮箱退信不能收说是不兼容
Our system has detected that this message
is 550-5.7.1 not RFC 2822 compliant
按照这个解决了一下，在邮件头添加了一下From和To
http://webmasters.stackexchange.com/questions/43059/why-is-an-email-failing-rfc2822-specifications
    </div>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="http://superwf.github.io/p398/" class="link black dim">
        php支持mongodb
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      本以为php内置了mongodb的支持，或者apt就可以下载自动配置。
最后还是照mongodb网站的指示做
先aptitude install php-pear php5-dev
pecl install mongo
再创建一个文件 /etc/php5/mods-available/mongo.ini
里面写
extension=mongo.so
ln -s /etc/php5/mods-available/mongo.ini /etc/php5/conf.d/mongo.ini
最后按系统规矩做个软链接
ln -s /etc/php5/mods-available/mongo.ini /etc/php5/conf.d/mongo.ini
重启fpm
    </div>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="http://superwf.github.io/p358/" class="link black dim">
        nginx&#43;fastcgi(11: Resource temporarily unavailable)
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      老项目上偶尔会出现404 error
老项目配置的是php4，单独编译的，每次出现这个错误的时候日志都是
nginx+fastcgi(11: Resource temporarily unavailable)
看socket文件是没问题，php4的进程也都在，之前都是重启php4的进程就行了，但为了一劳永逸，搜了一下
发现这个
http://forum.nginx.org/read.php?3,31467,31467
先暂时改了
sysctl net.core.somaxconn=8192
nignx配置文件里
event {
worker_connections 8192;
use epoll;
}
也跟着改了，先用一阵子看还有没有404错误。
    </div>
  </div>
</div>

        </div>
      
        <div class="relative w-100  mb4 bg-white">
          <div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="http://superwf.github.io/p165/" class="link black dim">
        php Internal Server Error
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      帮人配置个redhat上的php环境，万网已经给配置好了，但是一跑php就Internal Server Error
看了半天，说是改权限755了，没用。
看apache日志把，说是文件gid小于了允许运行的min_gid
把文件都改成apache用户所属
chown nobody:nobody /var/www/htdocs -R
搞定
    </div>
  </div>
</div>

        </div>
      
    </section>
  </div>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://superwf.github.io/" >
    &copy;  老王的日志 2020 
  </a>
    <div>













</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
